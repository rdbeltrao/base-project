(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{1912:function(e,t,r){Promise.resolve().then(r.bind(r,8627))},8627:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return N}});var n=r(3150),a=r(2145),s=r(9198),o=r(9579),i=r(5609);let l=s.fC,d=s.xz,c=s.h_;s.x8;let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(s.aV,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...a})});u.displayName=s.aV.displayName;let m=a.forwardRef((e,t)=>{let{className:r,children:a,...l}=e;return(0,n.jsxs)(c,{children:[(0,n.jsx)(u,{}),(0,n.jsxs)(s.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...l,children:[a,(0,n.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,n.jsx)(o.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});m.displayName=s.VY.displayName;let f=e=>{let{className:t,...r}=e;return(0,n.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...r})};f.displayName="DialogHeader";let x=e=>{let{className:t,...r}=e;return(0,n.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r})};x.displayName="DialogFooter";let h=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(s.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",r),...a})});h.displayName=s.Dx.displayName;let p=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(s.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",r),...a})});p.displayName=s.dk.displayName;var g=r(3209),v=r(233),y=r(2614),b=r(6443),j=r(2008);function N(){let{user:e,setUser:t}=(0,b.useAuth)(),[r,s]=(0,a.useState)(!1),[o,i]=(0,a.useState)(!1),[c,u]=(0,a.useState)(""),[N,w]=(0,a.useState)(!1),E=(0,j.cI)({defaultValues:{name:(null==e?void 0:e.name)||"",email:(null==e?void 0:e.email)||""}});(0,a.useEffect)(()=>{e&&E.reset({name:e.name||"",email:e.email||""})},[e,E]),(0,a.useEffect)(()=>{if(N){let e=setTimeout(()=>w(!1),3e3);return()=>clearTimeout(e)}},[N]);let k=async e=>{i(!0),u(""),w(!1);try{let r=await fetch("/api/auth/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name}),credentials:"include"});if(!r.ok){let e=await r.json();try{throw Error(e.message||"Erro ".concat(r.status,": ").concat(r.statusText))}catch(t){throw Error(e.error||"Erro ".concat(r.status,": ").concat(r.statusText))}}let n=await r.json();t(n.user),w(!0),s(!1)}catch(e){console.error("Erro ao atualizar perfil:",e),u(e instanceof Error?e.message:"Erro ao salvar as altera\xe7\xf5es. Tente novamente.")}finally{i(!1)}};return(0,n.jsxs)(n.Fragment,{children:[N&&(0,n.jsx)("div",{className:"mb-4 rounded-md bg-green-500/15 p-3 text-sm text-green-600",children:"Perfil atualizado com sucesso!"}),(0,n.jsx)("div",{className:"grid gap-6 pb-6 md:grid-cols-2 sm:grid-cols-1",children:(0,n.jsxs)("div",{className:"rounded-lg border border-border bg-card p-6 shadow-sm",children:[(0,n.jsx)("h2",{className:"mb-4 text-lg font-medium",children:"Informa\xe7\xf5es do Perfil"}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Nome:"}),(0,n.jsx)("p",{children:(null==e?void 0:e.name)||"N\xe3o informado"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Email:"}),(0,n.jsx)("p",{children:(null==e?void 0:e.email)||""})]})]}),(0,n.jsx)("div",{className:"mt-4",children:(0,n.jsxs)(l,{open:r,onOpenChange:s,children:[(0,n.jsx)(d,{asChild:!0,children:(0,n.jsx)(g.z,{children:"Editar Perfil"})}),(0,n.jsxs)(m,{children:[(0,n.jsxs)(f,{children:[(0,n.jsx)(h,{children:"Editar Perfil"}),(0,n.jsx)(p,{children:"Atualize suas informa\xe7\xf5es de perfil abaixo."})]}),(0,n.jsx)(v.l0,{...E,children:(0,n.jsxs)("form",{onSubmit:E.handleSubmit(k),className:"space-y-4",children:[(0,n.jsx)(v.Wi,{control:E.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsxs)(v.xJ,{children:[(0,n.jsx)(v.lX,{children:"Nome"}),(0,n.jsx)(v.NI,{children:(0,n.jsx)(y.I,{placeholder:"Seu nome",...t})}),(0,n.jsx)(v.zG,{})]})}}),(0,n.jsx)(v.Wi,{control:E.control,name:"email",render:e=>{let{field:t}=e;return(0,n.jsxs)(v.xJ,{children:[(0,n.jsx)(v.lX,{children:"Email"}),(0,n.jsx)(v.NI,{children:(0,n.jsx)(y.I,{type:"email",placeholder:"seu.email@exemplo.com",...t,disabled:!0})}),(0,n.jsx)(v.zG,{})]})}}),c&&(0,n.jsx)("div",{className:"rounded-md bg-destructive/15 p-3 text-sm text-destructive",children:c}),(0,n.jsxs)(x,{children:[(0,n.jsx)(g.z,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Cancelar"}),(0,n.jsx)(g.z,{type:"submit",disabled:o,children:o?"Salvando...":"Salvar"})]})]})})]})]})})]})})]})}},6443:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return g},useAuth:function(){return v}});var n=r(3150),a=r(2145),s=r(9733),o=r(2608);let i=o.env.NEXT_PUBLIC_COOKIE_NAME||"authToken",l=o.env.NEXT_PUBLIC_COOKIE_DOMAIN||"localhost",d=e=>{let{domain:t=l}=e,r={path:"/",sameSite:"lax"};return t&&(r.domain=t),r},c=e=>{let{cookieName:t=i,domain:r=l}=e;s.Z.remove(t,d({domain:r}))};var u=r(9612),m=r(68);let f=(e,t)=>!!e&&!!e.roles&&(!t||0===t.length||(e.permissions&&Array.isArray(e.permissions)?t.every(t=>e.permissions&&e.permissions.includes(t)):t.every(t=>{let[r,n]=t.split(".");return e.roles&&e.roles.some(e=>{var t;return null===(t=e.permissions)||void 0===t?void 0:t.some(e=>e.resource===r&&e.action===n)})})));var x=r(2608);async function h(e){try{let{payload:t}=await u._(e,new TextEncoder().encode(""),{requiredClaims:[],clockTolerance:"1000y"}).catch(()=>({payload:m.t(e)}));return t}catch(e){return console.error("Error decoding JWT token:",e),null}}let p=(0,a.createContext)(void 0),g=e=>{let{children:t,cookieName:r,domain:s,apiUrl:o}=e,[i,l]=(0,a.useState)(null),[d,u]=(0,a.useState)(!0),m=!!i;(0,a.useEffect)(()=>{(async()=>{try{u(!0);let e=await fetch("/api/auth/check-auth",{credentials:"include"});if(!e.ok){if(401===e.status){l(null);return}throw Error("Erro ".concat(e.status,": ").concat(e.statusText))}let t=await e.json();(null==t?void 0:t.authenticated)&&(null==t?void 0:t.user)?l(t.user):l(null)}catch(e){console.error("Auth check error:",e),l(null)}finally{u(!1)}})()},[o]);let g=async(e,t)=>{try{u(!0);let n=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t}),credentials:"include"});if(!n.ok)throw Error("Erro ".concat(n.status,": ").concat(n.statusText));let a=await n.json();if(null==a?void 0:a.token){var r;let e=a.token,t=await h(e);t&&t.user?l(t.user):(null==a?void 0:a.user)&&l(a.user);let n=(null==t?void 0:t.user)||(null==a?void 0:a.user),s=(null==n?void 0:null===(r=n.roles)||void 0===r?void 0:r.some(e=>"admin"===e))?"".concat(x.env.NEXT_PUBLIC_BACKOFFICE_URL,"/dashboard"):"/dashboard";return{success:!0,redirectUrl:s}}return{success:!1,error:"Credenciais inv\xe1lidas"}}catch(e){return console.error("Erro durante o login:",e),{success:!1,error:e instanceof Error?e.message:"Ocorreu um erro durante o login."}}finally{u(!1)}},v=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/login";u(!0);try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){console.error("Error during logout:",e),c({cookieName:r,domain:s})}l(null),u(!1),window.location.href=e};return(0,n.jsx)(p.Provider,{value:{user:i,setUser:l,isAuthenticated:m,isLoading:d,login:g,logout:v,hasPermissions:e=>f(i,e)},children:t})},v=()=>{let e=(0,a.useContext)(p);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},3209:function(e,t,r){"use strict";r.d(t,{z:function(){return d}});var n=r(3150),a=r(2145),s=r(5893),o=r(5778),i=r(5609);let l=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:r,variant:a,size:o,asChild:d=!1,...c}=e,u=d?s.g7:"button";return(0,n.jsx)(u,{className:(0,i.cn)(l({variant:a,size:o,className:r})),ref:t,...c})});d.displayName="Button"},233:function(e,t,r){"use strict";r.d(t,{l0:function(){return u},NI:function(){return v},Wi:function(){return f},xJ:function(){return p},lX:function(){return g},zG:function(){return y}});var n=r(3150),a=r(2145),s=r(5893),o=r(2008),i=r(5609),l=r(4164);let d=(0,r(5778).j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)(l.f,{ref:t,className:(0,i.cn)(d(),r),...a})});c.displayName=l.f.displayName;let u=o.RV,m=a.createContext({}),f=e=>{let{...t}=e;return(0,n.jsx)(m.Provider,{value:{name:t.name},children:(0,n.jsx)(o.Qr,{...t})})},x=()=>{let e=a.useContext(m),t=a.useContext(h),{getFieldState:r,formState:n}=(0,o.Gc)(),s=r(e.name,n);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...s}},h=a.createContext({}),p=a.forwardRef((e,t)=>{let{className:r,...s}=e,o=a.useId();return(0,n.jsx)(h.Provider,{value:{id:o},children:(0,n.jsx)("div",{ref:t,className:(0,i.cn)("space-y-2",r),...s})})});p.displayName="FormItem";let g=a.forwardRef((e,t)=>{let{className:r,...a}=e,{error:s,formItemId:o}=x();return(0,n.jsx)(c,{ref:t,className:(0,i.cn)(s&&"text-destructive",r),htmlFor:o,...a})});g.displayName="FormLabel";let v=a.forwardRef((e,t)=>{let{...r}=e,{error:a,formItemId:o,formDescriptionId:i,formMessageId:l}=x();return(0,n.jsx)(s.g7,{ref:t,id:o,"aria-describedby":a?"".concat(i," ").concat(l):"".concat(i),"aria-invalid":!!a,...r})});v.displayName="FormControl",a.forwardRef((e,t)=>{let{className:r,...a}=e,{formDescriptionId:s}=x();return(0,n.jsx)("p",{ref:t,id:s,className:(0,i.cn)("text-sm text-muted-foreground",r),...a})}).displayName="FormDescription";let y=a.forwardRef((e,t)=>{let{className:r,children:a,...s}=e,{error:o,formMessageId:l}=x(),d=o?String(null==o?void 0:o.message):a;return d?(0,n.jsx)("p",{ref:t,id:l,className:(0,i.cn)("text-sm font-medium text-destructive",r),...s,children:d}):null});y.displayName="FormMessage"},2614:function(e,t,r){"use strict";r.d(t,{I:function(){return o}});var n=r(3150),a=r(2145),s=r(5609);let o=a.forwardRef((e,t)=>{let{className:r,type:a,...o}=e;return(0,n.jsx)("input",{type:a,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),ref:t,...o})});o.displayName="Input"},5609:function(e,t,r){"use strict";r.d(t,{cn:function(){return s}});var n=r(1882),a=r(2471);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}}},function(e){e.O(0,[651,370,762,583,946,519,744],function(){return e(e.s=1912)}),_N_E=e.O()}]);