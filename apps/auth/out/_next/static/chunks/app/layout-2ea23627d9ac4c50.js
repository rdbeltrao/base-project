(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{1640:function(e,r,t){Promise.resolve().then(t.t.bind(t,7746,23)),Promise.resolve().then(t.bind(t,6443))},6443:function(e,r,t){"use strict";t.r(r),t.d(r,{AuthProvider:function(){return y},useAuth:function(){return p}});var n=t(3150),o=t(2145),s=t(9733),i=t(2608);let l=i.env.NEXT_PUBLIC_COOKIE_NAME||"authToken",u=i.env.NEXT_PUBLIC_COOKIE_DOMAIN||"localhost",a=e=>{let{domain:r=u}=e,t={path:"/",sameSite:"lax"};return r&&(t.domain=r),t},c=e=>{let{cookieName:r=l,domain:t=u}=e;s.Z.remove(r,a({domain:t}))};var d=t(9612),h=t(68);let v=(e,r)=>!!e&&!!e.roles&&(!r||0===r.length||(e.permissions&&Array.isArray(e.permissions)?r.every(r=>e.permissions&&e.permissions.includes(r)):r.every(r=>{let[t,n]=r.split(".");return e.roles&&e.roles.some(e=>{var r;return null===(r=e.permissions)||void 0===r?void 0:r.some(e=>e.resource===t&&e.action===n)})})));var f=t(2608);async function m(e){try{let{payload:r}=await d._(e,new TextEncoder().encode(""),{requiredClaims:[],clockTolerance:"1000y"}).catch(()=>({payload:h.t(e)}));return r}catch(e){return console.error("Error decoding JWT token:",e),null}}let E=(0,o.createContext)(void 0),y=e=>{let{children:r,cookieName:t,domain:s,apiUrl:i}=e,[l,u]=(0,o.useState)(null),[a,d]=(0,o.useState)(!0),h=!!l;(0,o.useEffect)(()=>{(async()=>{try{d(!0);let e=await fetch("/api/auth/check-auth",{credentials:"include"});if(!e.ok){if(401===e.status){u(null);return}throw Error("Erro ".concat(e.status,": ").concat(e.statusText))}let r=await e.json();(null==r?void 0:r.authenticated)&&(null==r?void 0:r.user)?u(r.user):u(null)}catch(e){console.error("Auth check error:",e),u(null)}finally{d(!1)}})()},[i]);let y=async(e,r)=>{try{d(!0);let n=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r}),credentials:"include"});if(!n.ok)throw Error("Erro ".concat(n.status,": ").concat(n.statusText));let o=await n.json();if(null==o?void 0:o.token){var t;let e=o.token,r=await m(e);r&&r.user?u(r.user):(null==o?void 0:o.user)&&u(o.user);let n=(null==r?void 0:r.user)||(null==o?void 0:o.user),s=(null==n?void 0:null===(t=n.roles)||void 0===t?void 0:t.some(e=>"admin"===e))?"".concat(f.env.NEXT_PUBLIC_BACKOFFICE_URL,"/dashboard"):"/dashboard";return{success:!0,redirectUrl:s}}return{success:!1,error:"Credenciais inv\xe1lidas"}}catch(e){return console.error("Erro durante o login:",e),{success:!1,error:e instanceof Error?e.message:"Ocorreu um erro durante o login."}}finally{d(!1)}},p=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/login";d(!0);try{await fetch("/api/auth/logout",{method:"POST",credentials:"include"})}catch(e){console.error("Error during logout:",e),c({cookieName:t,domain:s})}u(null),d(!1),window.location.href=e};return(0,n.jsx)(E.Provider,{value:{user:l,setUser:u,isAuthenticated:h,isLoading:a,login:y,logout:p,hasPermissions:e=>v(l,e)},children:r})},p=()=>{let e=(0,o.useContext)(E);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},7746:function(){}},function(e){e.O(0,[378,651,946,519,744],function(){return e(e.s=1640)}),_N_E=e.O()}]);